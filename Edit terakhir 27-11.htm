<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dashboard Audit BMKG</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
    :root {
    --bg:#f3f6fb;
    --card:#ffffff;
    --muted:#111111;
    --accent-blue:#003153;
    --tosca:#81D8D0;
    --blue-1:#B8E0D2;
    --blue-2:#81D8D0;
    --orange-1:#DCEFF5;
    --orange-2:#B8E0D2;
    --radius:16px;
    --shadow:0 8px 24px rgba(18,35,64,0.08);
    font-family:"Inter",ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
}

/* ===== HEADER BIRU FULL WIDTH ===== */
.main-header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 70px;
    background: #003153;
    color: #fff;
    padding: 10px 30px;
    z-index: 2;
    display: flex;
    flex-direction: column;
    justify-content: center;
    box-shadow: 0 2px 12px rgba(0,0,0,0.15);
}

.header-title {
    font-size: 22px;
    font-weight: 700;
    margin: 0;
}
.header-sub {
    font-size: 12px;
    opacity: .85;

}

/* geser sidebar agar nempel di bawah header */
.sidebar {
    top: 70px !important;
    height: calc(100vh - 70px);
}

/* geser main content agar tidak tertimpa header */
.main {
    margin-top: 70px !important;
}

/* Warna khusus PQ tertentu */
.card-gray {
    background: linear-gradient(180deg, #f4f4f4, #D8A48F);
    border: 1px solid #d0d0d0;
}

html,body{
    height:100%;
    margin:0;
    background:var(--bg);
    color:#0f1724;
}

/* ===== LAYOUT ===== */
.container {
    display:flex;
    height:100vh;
}

/* ===== SIDEBAR KIRI ===== */
.sidebar {
    width:260px;
    background:linear-gradient(180deg,#ffffff,#f5faff);
    box-shadow:2px 0 10px rgba(0,0,0,0.05);
    padding:24px;
    display:flex;
    flex-direction:column;
    gap:14px;
    position:fixed;
    left:0;
    top:0;
    bottom:0;
}

.brand {
    font-weight:700;
    color:var(--accent-blue);
    font-size:15px;
    margin-left: 5px !important;
}

.menu {
    margin-top:20px;
    display:flex;
    flex-direction:column;
    gap:10px;
}

.menu button {
    width:100%;
    background:transparent;
    border:none;
    text-align:left;
    padding:12px 14px;
    font-weight:600;
    border-radius:10px;
    color:#1f2937;
    cursor:pointer;
    transition:all .2s ease;
}

.menu button:hover {
    background-color:#eef6ff;
}

.menu button.active {
    background-color:#dbeafe;
    color:var(--accent-blue);
}

.footer {
    margin-top:auto;
    font-size:12px;
    color:var(--muted);
    text-align:left;
}

/* ===== MAIN CONTENT ===== */
.main {
    flex:1;
    padding:60px;
    margin-left:260px; /* ruang untuk sidebar kiri */
    overflow-y:auto;
    display:flex;
    justify-content:center;
    align-items:flex-start;
}

/* ===== HOME PAGE ===== */
.home-container {
    border-radius: 20px;
    box-shadow: var(--shadow);
    padding: 80px 60px;
    text-align: center;
    max-width: 900px;
    width: 100%;
    height: 80vh;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    box-sizing: border-box;
    overflow: hidden;

    background-image: url('https://images.unsplash.com/photo-1662089330227-e8ce9a9ff934?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&q=80&w=1032');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
}

/* ===== HOME CARDS (MENU UTAMA) ===== */
.home-cards {
    display: flex;
    gap: 24px;
    justify-content: center;
    align-items: center;
    margin-top: 40px;
    z-index: 2;
}

.home-card {
    border: 1px solid rgba(255,255,255,0.3);
    padding: 22px 28px;
    min-width: 200px;
    text-align: center;
    border-radius: 22px;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    transition: transform .25s ease, box-shadow .25s ease;
    color: var(--accent-blue);
    display: flex;
    flex-direction: column;
    align-items: center;
}

.home-card-icon {
    width: 56px;
    height: 56px;
    margin-bottom: 10px;
    transition: transform .2s ease;
}

.home-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 16px 36px rgba(0,0,0,0.22);
}

.home-card:hover .home-card-icon {
    transform: scale(1.12);
}

/* ===== MODAL INFO HOME ===== */
.home-card-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.45);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 80;
    padding: 24px;
    box-sizing: border-box;
}

.home-card-overlay.show {
    display: flex;
}

.home-card-modal {
    width: min(480px, 100%);
    background: #ffffff;
    border-radius: 18px;
    padding: 24px 26px;
    box-shadow: 0 24px 60px rgba(0,0,0,0.35);
    text-align: left;
    animation: homeModalIn .22s ease-out;
}

.home-card-modal h3 {
    margin: 0 0 10px 0;
    font-size: 20px;
    font-weight: 800;
    color: var(--accent-blue);
}

.home-card-modal p {
    margin: 0;
    font-size: 14px;
    line-height: 1.6;
    color: var(--muted);
}

.btn-close-home {
    margin-top: 20px;
    padding: 8px 16px;
    border-radius: 999px;
    border: 0;
    background: var(--accent-blue);
    color: #fff;
    font-weight: 600;
    cursor: pointer;
    font-size: 14px;
}

.btn-close-home:hover {
    opacity: .9;
}

@keyframes homeModalIn {
    from { opacity: 0; transform: translateY(8px); }
    to   { opacity: 1; transform: translateY(0); }
}

/* ===== PROTOCOL QUESTION PAGE ===== */
.pq-container {
    display:none;
    flex-direction:column;
    gap:18px;
    width:100%;
    max-width:1200px;
    margin:auto;
}

.header{
    display:flex;align-items:center;justify-content:space-between;
    width:100%;
    margin-bottom:12px;
}
.title {
    font-size: 30px;
    font-weight: 750;
    color: #111111;
    margin-top: -10px;
    letter-spacing: 0.3px;
}
.search{
    display:flex;gap:8px;align-items:center;
}
.search input{
    padding:8px 12px;border-radius:10px;border:1px solid #e6eef8;background:#fff;
    min-width:240px;
}

.content{
    display:grid;
    grid-template-columns: 1fr 340px;
    gap:12px;
    align-items:start;
    width:100%;
}

/* PQ panel */
.pq-panel{
    background:linear-gradient(180deg,#fff,#fbfdff);
    padding:14px;border-radius:var(--radius);box-shadow:0 6px 20px rgba(18,35,64,0.06);
    min-height:520px; margin-right: 0;
}
.pq-grid{
    display:flex;
    flex-direction: column;
    gap:16px;
}
.pq-card{
    background:var(--card);
    padding:20px;border-radius:24px;border:1px solid rgba(15,23,36,0.04);
    box-shadow: 0 6px 20px rgba(7,12,34,0.04);
    transition:transform .18s ease, box-shadow .18s ease, filter .18s;
    cursor:pointer;
    display:flex;flex-direction:column;gap:10px;
}
.pq-card.dimmed{filter:grayscale(.2) brightness(.85)}
.pq-card:hover{transform:translateY(-4px);box-shadow:0 10px 30px rgba(7,12,34,0.08)}
.pq-card .heading{font-weight:700;color:var(--accent-blue);font-size:14px}
.pq-card .meta{font-size:12px;color:var(--muted);line-height:1.3}
.pq-card .controls{display:flex;gap:8px;align-items:center;justify-content:space-between}
.pq-card select{padding:6px;border-radius:8px;border:1px solid #e6eef8;background:#fff}
.pq-card.active {
    z-index: 9500 !important;
}

/* Warna abu-abu lembut untuk PQ tertentu */
.card-gray {
    background: linear-gradient(180deg, #FFA07A, #d8cfcf) !important;
    border: 1px solid #bfbfbf !important;
    color: #111 !important;
}

/* color variants for cards */
.card-blue{background:linear-gradient(180deg,var(--blue-1),var(--blue-2))}
.card-orange{background:linear-gradient(180deg,var(--orange-1),var(--orange-2))}

/* Legend warna Non-MWO & MWO */
.pq-legend {
    display: flex;
    align-items: center;
    gap: 16px;
    font-size: 12px;
    margin-bottom: 4px;
    color: var(--muted);
}
.legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
}
.legend-color {
    width: 14px;
    height: 14px;
    border-radius: 4px;
    display: inline-block;
}
.legend-color.blue {
    background: var(--blue-2);
}
.legend-color.red {
    background: #F9A584;
}

/* right column: preparation + regulations */
.right-panel{
    display:flex;flex-direction:column;gap:12px;
}
.box{
    background:var(--card);padding:14px;border-radius:12px;box-shadow:0 10px 24px rgba(18,35,64,0.06);
}
.box h4{margin:0 0 8px 0;color:var(--accent-blue)}

/* ===== PERSIAPAN PAGE ===== */
.prep-cards {
    display: flex;
    gap: 24px;
    justify-content: center;
    flex-wrap: wrap;
}

/* Card umum */
.prep-card {
    flex: 1 1 260px;
    padding: 24px;
    border-radius: 16px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.05);
    transition: transform .2s ease, box-shadow .2s ease;
    text-align: center;
    color: #111;
}
.prep-card:nth-child(1) {
    background: linear-gradient(180deg, #CCFBF1, #E0F7FA);
}
.prep-card:nth-child(2) {
    background: linear-gradient(180deg, #FFEFD5, #FFF8DC);
}
.prep-card:nth-child(3) {
    background: linear-gradient(180deg, #E6E6FA, #FFF0F5);
}

.prep-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
}

.prep-card h4 {
    color: var(--accent-blue);
    margin-bottom: 10px;
    font-weight: 700;
}

.prep-card p,
.prep-card li {
    color: var(--muted);
    font-size: 14px;
    line-height: 1.5;
}
.prep-list{display:flex;flex-direction:column;gap:8px}
.prep-item{display:flex;gap:8px;align-items:center; justify-content:space-between;padding:8px;border-radius:10px;background:#fbfdff;border:1px solid rgba(15,23,36,0.03)}
.prep-item .left{display:flex;gap:8px;align-items:center}
.tag{font-size:12px;color:var(--muted);padding:6px 8px;border-radius:999px;background:rgba(15,23,36,0.04)}

.regs-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.reg-card{padding:10px;border-radius:10px;text-align:center;font-weight:700;box-shadow:0 6px 16px rgba(8,16,32,0.04)}
.reg-blue{background:#eaf4ff;color:var(--accent-blue)}
.reg-green{background:#e9fbf0;color:#0a5e3a}
.reg-orange{background:#fff6ea;color:#7a4b00}

/* modal / expanded card */
.overlay{
    position:fixed;inset:0;display:none;
    justify-content:center;
    background:rgba(7,12,20,0.45);z-index:60;
    align-items: flex-start;
    overflow-y: auto;
    padding: 5vh 0;
    box-sizing: border-box;
}
.overlay.show{display:flex}
.modal{width:min(920px,95%);background:var(--card);border-radius:14px;padding:20px;box-shadow:0 30px 80px rgba(8,16,32,0.5)}

.modal .row{display:block; gap:12px}
.modal .col{flex:1}

.modal-frame {
    border: 1px solid #e3e8ef;
    background: #fafcff;
    border-radius: 10px;
    padding: 10px 14px;
    margin-bottom: 12px;
    box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);
}

/* Warna pink lembut untuk tiga bagian modal */
#modalResponse.modal-frame {
    background: #F2F2F2 !important;
    border: 1px solid #D8A7B1 !important;
}
#modalGuide.modal-frame {
    background: #F2F2F2 !important;
    border: 1px solid #D8A7B1 !important;
}
#modalEvidence.modal-frame {
    background: #F2F2F2 !important;
    border: 1px solid #D8A7B1 !important;
}

/* Styles untuk Form Input (Halaman SA) */
.modal label, .assessment-form-container label {
    display: block;
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 4px;
    color: var(--accent-blue);
}
.modal textarea, .modal select, .assessment-form-container textarea, .assessment-form-container select {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    margin-bottom: 12px;
    box-sizing: border-box;
    background: #fffbfb;
    font-size: 14px;
    font-family: inherit;
}
.modal button[type="submit"], .assessment-form-container button[type="submit"] {
    display: none;
}
.btn-download-pdf {
    width: 100%;
    max-width: 400px;
    padding: 15px 12px;
    border-radius: 8px;
    border: 0;
    background: #B31B1B;
    color: #fff;
    font-weight: 700;
    cursor: pointer;
    transition: background-color 0.2s;
    margin-top: 30px;
    margin-bottom: 20px;
    font-size: 16px;
}
.btn-download-pdf:hover {
    background: #8b1515;
}

/* Tombol Dokumen di Modal */
#modalDocContainer {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
}
#modalDocContainer h4 {
    margin: 0;
}
#modalDocBtn {
    display: none;
    align-items: center;
    justify-content: center;
    gap: 4px;
    padding: 4px 8px;
    border: none;
    border-radius: 4px;
    background-color: #003153;
    color: #ffffff;
    font-size: 12px;
    font-weight: 500;
    line-height: 1;
    cursor: pointer;
    transition: background-color 0.2s;
    text-decoration: none;
}

/* FAQ styles */
.faq-container {
    max-width: 900px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 14px;
}
.faq-item {
    background: #ffffff;
    border-radius: 12px;
    padding: 14px 16px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}
.faq-q {
    font-weight: 700;
    color: var(--accent-blue);
    margin-bottom: 6px;
}
.faq-a {
    font-size: 14px;
    color: var(--muted);
    line-height: 1.5;
}

/* responsive */
@media (max-width:980px){
    .main{padding:20px;margin-left:0}
    .sidebar{display:none}
    .content{grid-template-columns:1fr; }
    .right-panel{order:2}
    .pq-panel{order:1}
    .pq-grid{grid-template-columns:1fr}
    .modal .row{display:block;}
    .modal {width: 95%;}
}

.contact-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
  justify-content: center;
}

.contact-card {
  background: var(--card);
  border-radius: 12px;
  padding: 16px 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  width: 220px;
  text-align: center;
}
.contact-card h4 {
  color: var(--accent-blue);
  margin-bottom: 4px;
}
.contact-card .jabatan {
  color: var(--muted);
  font-size: 13px;
  margin-bottom: 8px;
}
.contact-card .hp {
  font-weight: 600;
}

/* ===== Self Assessment Page Styles ===== */
.sa-container {
    display: none;
    flex-direction: column;
    gap: 20px;
    width: 100%;
    max-width: 900px;
    align-items: center;
}
.sa-card {
    background: #ffffff;
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    padding: 20px;
    border-left: 5px solid var(--accent-blue);
    width: 100%;
    box-sizing: border-box;
}
.sa-header {
    font-size: 18px;
    font-weight: 700;
    color: #111;
    margin-bottom: 10px;
}
.sa-question {
    font-size: 14px;
    color: var(--muted);
    line-height: 1.5;
    margin-bottom: 15px;
    border-bottom: 1px dashed #eee;
    padding-bottom: 10px;
}
.assessment-form-container {
    background: #f7f9fc;
    padding: 15px;
    border-radius: 10px;
    margin-top: 10px;
}
.form-message-sa {
    display: none;
}
.pdf-content h3 {
    color: #003153;
    border-bottom: 2px solid #003153;
    padding-bottom: 5px;
    margin-top: 20px;
    font-size: 16px;
}
.pdf-content p {
    margin: 5px 0;
    font-size: 12px;
}
.pdf-content .status-label {
    font-weight: bold;
    color: #B31B1B;
}
.pdf-content .assessment-form-container {
    display: none !important;
}
.pdf-content .sa-question {
    border-bottom: none;
    padding-bottom: 0;
}

/* ==== HALAMAN PERSIAPAN (AUDIT FLOW) ==== */
.audit-container {
  background: #fff;
  max-width: 1100px;
  border: 2px solid #ddd;
  border-radius: 12px;
  padding: 30px 25px;
  margin: 20px auto;
  box-shadow: 0 4px 20px rgba(0,0,0,0.05);
  font-family: "Segoe UI", sans-serif;
}
.audit-header {
  text-align: center;
  margin-bottom: 25px;
}
.audit-header h2 {
  font-size: 22px;
  color: #003153;
  font-weight: 700;
  letter-spacing: 0.5px;
  text-transform: uppercase;
  margin: 0;
}
.audit-flow {
  display: flex;
  justify-content: space-between;
  flex-wrap: nowrap;
  gap: 20px;
}
.audit-column {
  border-right: 2px dashed #ccc;
  padding: 10px 20px;
  box-sizing: border-box;
  text-align: center;
}
.audit-column:last-child {
  border-right: none;
}
.audit-column:nth-child(1),
.audit-column:nth-child(2) {
  flex: 1;
  min-width: 200px;
}
.audit-column:nth-child(3) {
  flex: 1.3;
  min-width: 380px;
}
.audit-title {
  font-weight: bold;
  font-size: 18px;
  color: #003153;
  text-align: center;
  margin-bottom: 10px;
  text-transform: uppercase;
}
.audit-box {
  background: #f7f9fc;
  border-radius: 10px;
  padding: 10px 15px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  font-size: 13px;
  margin-bottom: 10px;
  text-align: left;
}
.audit-box.small {
  font-size: 10px;
  padding: 4px 10px;
  border-radius: 6px;
  width: fit-content;
  margin: 0 auto 8px auto;
  background: #111;
  color: #fff;
  box-shadow: 0 1px 3px rgba(0,0,0,0.25);
}
.audit-yellow { background: #D3D3D3; }
.audit-red { background: #D3D3D3; }
.audit-purple { background: #D3D3D3; }
.audit-blue { background: #D3D3D3; }
.audit-footer {
  display: flex;
  justify-content: center;
  gap: 30px;
  margin-top: 10px;
}
.audit-label {
  background: #003153;
  color: white;
  font-weight: bold;
  padding: 6px 18px;
  border-radius: 5px;
  font-size: 13px;
  text-transform: uppercase;
}
.audit-label.inspektur {
  background: #b31b1b;
}
.audit-box ul {
  margin: 8px 0 0 18px;
  padding: 0;
}
.audit-box li { margin-bottom: 5px; }
.pasca-row {
  display: flex;
  justify-content: space-between;
  align-items: stretch;
  gap: 15px;
  margin-top: 10px;
}
.pasca-col {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* ===== HOME HERO ala Medicio ===== */
.home-hero {
    position: relative;
    width: 100%;
    height: 80vh;
    align-items: center;
    justify-content: center;
    background-image: url('https://images.unsplash.com/photo-1662089330227-e8ce9a9ff934?auto=format&fit=crop&q=80&w=1600');
    background-size: cover;
    background-position: center;
}

/* Slide container */
.hero-slide {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity .7s ease;
}
.hero-slide.active {
    opacity: 1;
}

/* Kotak putih tengah */
.hero-slide-inner {
    width: 90%;
    max-width: 900px;
    background: rgba(255,255,255,0.90);
    padding: 5px 80px;
    text-align: center;
    border-top: 4px solid #11c5c6;
    border-radius: 12px;
}

/* Headings */
.hero-title {
    font-size: 42px;
    font-weight: 800;
    color: #444;
    margin-bottom: 18px;
}
.hero-text {
    max-width: 900px;
    margin: 0 auto 32px;
    font-size: 18px;
    color: #555;
    line-height: 1.6;
}
.hero-subtext {
    font-size: 16px;
    color: #777;
    line-height: 1.4;
}

/* Tombol */
.hero-btn-main {
    margin-top: 32px;
    padding: 14px 38px;
    border-radius: 50px;
    border: none;
    font-size: 18px;
    font-weight: 700;
    background: #11c5c6;
    color: #fff;
    cursor: pointer;
    transition: .2s;
}
.hero-btn-main:hover {
    transform: translateY(-3px);
}

/* Bullet dots */
.hero-dots {
    position: absolute;
    bottom: 32px;
    left: 50%;
    transform: translateX(-50%);
    gap: 8px;
    display: none !important;
}
.hero-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(255,255,255,.7);
    cursor: pointer;
}
.hero-dot.active {
    background: #11c5c6;
}

/* Perbesar modal Read More */
.home-card-modal {
    width: 90vw !important;
    max-width: 1100px !important;
    padding: 40px 50px !important;
    border-radius: 24px;
}
.home-card-modal h3 {
    font-size: 24px !important;
    margin-bottom: 14px;
}
.home-card-modal p {
    font-size: 16px !important;
    line-height: 1.6;
}

/* Heading di atas card */
.hero-header-text {
    position: absolute;
    top: 32%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100%;
    text-align: center;
    z-index: 5;
}

/* Subjudul BMKG */
.hero-subtext-top {
    margin-top: 14px;
    font-size: 18px;
    color: #eaeaea;
    font-weight: 500;
    text-shadow: 0 2px 10px rgba(0,0,0,0.4);
}

/* Responsive hero */
@media(max-width:768px){
    .hero-slide-inner{
        width: 90%;
        padding: 24px;
    }
    .hero-title {
        font-size: 30px;
    }
}

/* Background hero lebih bersih */
.home-hero {
    filter: none !important;
    background-color: transparent !important;
}
.hero-slide-inner {
    background: rgba(255,255,255,0.85) !important;
    backdrop-filter: none !important;
}
.hero-header-text {
    text-shadow: 0 3px 12px rgba(0,0,0,0.25);
    backdrop-filter: none !important;
}

/* Z-index layout */
.main-header {
    z-index: 1000 !important;
}
.main,
#homePage,
#pqPage,
    padding-top: 30px !important;
#selfAssessmentPage,
#persiapanPage,
#GambaranUmumPage,
#KontakTimPage,
#faqPage {
    position: relative !important;
    z-index: 9998 !important;
}
.overlay,
.home-card-overlay {
    z-index: 10000 !important;
}
/* Hilangkan card putih pada halaman Tahapan Pelaksanaan Audit */
.audit-container {
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
    padding: 0 !important;
}

</style>
</head>
<body>
<header class="main-header">
    <div class="header-title">
        Dashboard Panduan Persiapan Audit<br>
        Keselamatan Navigasi Penerbangan Bidang Meteorologi
    </div>
    <div class="header-sub">Resource & guidance untuk Stamet</div>
</header>

<div class="container">
    <aside class="sidebar">
        <div class="brand">Direktorat Meteorologi Penerbangan - BMKG</div>

        <nav class="menu">
            <button id="btnHome" class="active">Home</button>
            <button id="btnGambaranUmum">Glossary</button>
            <button id="btnPersiapan">Audit Stages</button>
            <button id="btnPQ">Protocol Question</button>
            <button id="btnSelfAssessment">Self Assessment</button>
            <button id="btnFAQ">FAQ</button>
            <button id="btnKontakTim">Team Contacts</button>
        </nav>

        <div class="footer">BMKG ‚Ä¢ Internal</div>
    </aside>

    <main class="main">
        <!-- HOME -->
        <section id="homePage" class="home-hero">
            <div class="hero-slide active">
                <div class="hero-slide-inner">
                    <p class="hero-text">
                        Dashboard panduan persiapan pengawasan (audit) meteorologi penerbangan ini
                        berisi evaluasi mandiri, evidence operasional, dan informasi pemenuhan
                        standar layanan meteorologi penerbangan sesuai ketentuan keselamatan navigasi
                        penerbangan.
                    </p>
                    <button class="hero-btn-main" onclick="openHomeHeroModal()">
                        Read More
                    </button>
                </div>
            </div>

            <div class="hero-dots">
                <span class="hero-dot active" onclick="goToHeroSlide(0)"></span>
            </div>
        </section>

        <!-- PQ PAGE -->
        <section id="pqPage" class="pq-container" aria-hidden="true">
            <div class="header">
                <div>
                    <div class="title">Alat Bantu Tanggapan Protocol Question</div>
                    <div style="font-size:13px;color:var(--muted)">
                        Klik kartu untuk melihat detail dan panduan pemeriksaan
                    </div>
                </div>
                <div class="search">
                    <input id="qsearch" placeholder="Cari PQ, kata kunci, regulasi..." />
                    <button id="btnSearch" style="padding:8px 12px;border-radius:10px;border:0;background:var(--accent-blue);color:#fff;cursor:pointer">Cari</button>
                </div>
            </div>

            <section class="content">
                <section class="pq-panel" aria-labelledby="pq-heading">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                        <div class="pq-legend">
                            <div class="legend-item">
                                <span class="legend-color blue"></span>
                                Non-MWO
                            </div>
                            <div class="legend-item">
                                <span class="legend-color red"></span>
                                MWO
                            </div>
                        </div>
                        <div style="font-size:13px;color:var(--muted)">
                            Total PQ: <span id="total-pq">0</span>
                        </div>
                    </div>

                    <div class="pq-grid" id="pqGrid"></div>
                </section>

                <aside class="right-panel">
                    <div class="box">
                        <h4>Referensi Dokumen</h4>
                        <div class="prep-list">
                            <div class="prep-item" id="btnReferensi" style="cursor:pointer;">
                                <div class="left">
                                    <div class="tag">PDF</div>
                                    <div style="font-weight:700">PR 3 Tahun 2023</div>
                                </div>
                                <div style="font-size:12px;color:var(--muted)">Terkini</div>
                            </div>
                        </div>
                    </div>

                    <div class="box">
                        <h4>Regulasi Terkait</h4>
                        <div class="regs-grid">
                            <div class="reg-card reg-blue">Pengamatan</div>
                            <div class="reg-card reg-green">Prakiraan</div>
                            <div class="reg-card reg-orange">Peringatan</div>
                            <div class="reg-card reg-blue">Lainnya</div>
                        </div>
                    </div>
                </aside>
            </section>

            <div class="overlay" id="overlay" aria-hidden="true">
                <div class="modal" role="dialog" aria-modal="true">
                    <div style="display:flex;justify-content:space-between;align-items:center">
                        <div>
                            <div id="modalTitle" style="font-weight:800;font-size:18px;color:var(--accent-blue)"></div>
                            <div id="modalSub" style="font-size:13px;color:var(--muted)"></div>
                        </div>
                        <div>
                            <button onclick="closeModal()" style="padding:6px 10px;border-radius:8px;border:0;background:#f3f4f6;cursor:pointer">Tutup</button>
                        </div>
                    </div>
                    <hr style="margin:12px 0;border:none;border-top:1px solid #eef3fb" />
                    <div class="row">
                        <div class="col">
                            <h4 style="margin:0 0 8px 0;color:var(--accent-blue)">Tanggapan Auditee</h4>
                            <div id="modalResponse" class="modal-frame" style="color:var(--muted);"></div>

                            <h4 style="margin-top:8px;color:var(--accent-blue)">Panduan Pemeriksaan</h4>
                            <div id="modalGuide" class="modal-frame" style="color:var(--muted);"></div>

                            <div id="modalDocContainer">
                                <h4 style="color:var(--accent-blue)">Bukti Dokumen</h4>
                                <a id="modalDocBtn" href="#" target="_blank"
                                   title="Lihat Dokumen">
                                    Download
                                </a>
                            </div>

                            <div id="modalEvidence" class="modal-frame" style="color:var(--muted);line-height:1.5"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SELF ASSESSMENT -->
        <section id="selfAssessmentPage" class="sa-container" style="display:none;">
            <div class="title">Self Assessment</div>
            <div style="font-size:13px;color:var(--muted); margin-bottom: 20px;">
                Jawab pertanyaan dan tetapkan status implementasi untuk setiap Protocol Question.
                <b>Hasil isian akan otomatis tersimpan sementara di halaman ini.</b>
            </div>

            <div id="saContent"></div>

            <button id="btnDownloadPDF" class="btn-download-pdf">
                <svg width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' style="vertical-align: middle; margin-right: 8px;">
                    <path d='M12 17v-8'></path>
                    <path d='M15 14l-3 3l-3-3'></path>
                    <path d='M18 20H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h4l4 4v10a2 2 0 0 0 2 2z'></path>
                </svg>
                Download Hasil Self Assessment (PDF)
            </button>
            <p id="downloadStatus" style="font-size:14px; color: #B31B1B; font-weight: 600;"></p>
        </section>

        <!-- PERSIAPAN -->
        <section id="persiapanPage" class="content-section" style="display:none; width: 100%; max-width: 1100px;">
         <div class="title" style="text-align:center; margin-bottom:20px;">
    üìã Tahapan Pelaksanaan Audit
</div>
<p style="text-align:center;color:var(--muted);font-size:14px;max-width:780px;margin:0 auto 20px;">
    Tahapan persiapan, pelaksanaan on-site, dan pasca audit sesuai ketentuan Direktorat Meteorologi Penerbangan.
</p>

        <div class="audit-container">
                <div class="audit-header">
                </div>

                <div class="audit-flow">
                  <div class="audit-column">
                    <div class="audit-title">PRA AUDIT</div>
                    <div class="audit-box small">SELF ASSESSMENT</div>
                    <div class="audit-box audit-yellow">
                      <ul>
                        <li>Menjawab Protocol Question</li>
                        <li>Menyatakan SATISFACTORY / NOT SATISFACTORY / NOT APPLICABLE</li>
                        <li>Dilakukan sebelum pelaksanaan audit (PRA AUDIT)</li>
                      </ul>
                    </div>
                    <div class="audit-footer">
                      <div class="audit-label">AUDITEE</div>
                    </div>
                  </div>

                  <div class="audit-column">
                    <div class="audit-title">ON SITE AUDIT</div>
                    <div class="audit-box small">REVIEW SELF ASSESSMENT</div>
                    <div class="audit-box audit-red">
                      <ul>
                        <li>Menetapkan SATISFACTORY / TIDAK</li>
                        <li>Mengklasifikasikan RISK INDEX</li>
                        <li>Menyusun DESKRIPSI, FINDING, RECOMMENDATION</li>
                      </ul>
                    </div>
                    <div class="audit-footer">
                      <div class="audit-label inspektur">INSPEKTUR</div>
                    </div>
                  </div>

                  <div class="audit-column">
                    <div class="audit-title">PASCA</div>
                    <div class="pasca-row">
                      <div class="pasca-col">
                        <div class="audit-box small">PENYUSUNAN CORRECTIVE ACTION PLAN</div>
                        <div class="audit-box audit-purple">
                          Menetapkan langkah perbaikan dan target waktu sesuai finding
                        </div>
                        <div class="audit-footer">
                          <div class="audit-label">AUDITEE</div>
                        </div>
                      </div>

                      <div class="pasca-col">
                        <div class="audit-box small">REVIEW CORRECTIVE ACTION PLAN</div>
                        <div class="audit-box audit-blue">
                          <ul>
                            <li>Menetapkan apakah CAP sesuai dengan rekomendasi (ADDRESSED / NOT ADDRESSED)</li>
                            <li>Menetapkan status PQ apakah sudah berubah menjadi SATISFACTORY atau belum</li>
                            <li>Menetapkan RISK INDEX baru</li>
                            <li>Memberikan comment atas CAP yang telah dilaksanakan</li>
                          </ul>
                        </div>
                        <div class="audit-footer">
                          <div class="audit-label inspektur">INSPEKTUR</div>
                        </div>
                      </div>
                    </div>
                  </div>

                </div>
            </div>
        </section>

        <!-- GLOSARIUM -->
        <section id="GambaranUmumPage" style="display:none;">
            <div class="title" style="text-align:center;margin-bottom:16px;">
                üìö Glosarium Meteorologi Penerbangan
            </div>

            <p style="text-align:center;color:var(--muted);font-size:14px;max-width:780px;margin:0 auto 20px;">
                Daftar istilah penting untuk mendukung pemahaman Protocol Question dan Self Assessment.
            </p>

            <div style="overflow-x:auto;max-width:1000px;margin:auto;">
                <table style="width:100%;border-collapse:collapse;font-size:14px;background:#fff;">
                    <thead>
                        <tr style="background:#f1f4f9;color:#003153;">
                            <th style="padding:10px;border:1px solid #e3e8ef;text-align:left;">Istilah</th>
                            <th style="padding:10px;border:1px solid #e3e8ef;text-align:left;">Definisi</th>
                        </tr>
                    </thead>
                    <tbody>
                       <tbody>
<tr>
<td style="padding:10px;border:1px solid #e3e8ef;"><strong>AIP / AIP SUP / NOTAM</strong></td>
<td style="padding:10px;border:1px solid #e3e8ef;">Publikasi informasi aeronautika yang berdampak pada keselamatan navigasi penerbangan.</td>
</tr>

<tr>
<td style="padding:10px;border:1px solid #e3e8ef;"><strong>AMP</strong></td>
<td style="padding:10px;border:1px solid #e3e8ef;">Aeronautical Meteorological Personnel ‚Äî personel meteorologi penerbangan yang telah memenuhi kompetensi sesuai standar untuk mendukung keselamatan penerbangan.</td>
</tr>

<tr>
<td style="padding:10px;border:1px solid #e3e8ef;"><strong>Annex 3</strong></td>
<td style="padding:10px;border:1px solid #e3e8ef;">Standar ICAO terkait pelayanan meteorologi untuk navigasi penerbangan.</td>
</tr>

<tr>
<td style="padding:10px;border:1px solid #e3e8ef;"><strong>Auditee</strong></td>
<td style="padding:10px;border:1px solid #e3e8ef;">Unit yang menjadi objek audit, seperti Stasiun Meteorologi Penerbangan atau MWO.</td>
</tr>

<tr>
<td style="padding:10px;border:1px solid #e3e8ef;"><strong>Auditor</strong></td>
<td style="padding:10px;border:1px solid #e3e8ef;">Personel yang berwenang melakukan pemeriksaan pemenuhan persyaratan layanan meteorologi penerbangan.</td>
</tr>

<tr>
<td style="padding:10px;border:1px solid #e3e8ef;"><strong>CAP</strong></td>
<td style="padding:10px;border:1px solid #e3e8ef;">Corrective Action Plan ‚Äî rencana tindakan perbaikan terhadap temuan audit.</td>
</tr>

<tr>
<td style="padding:10px;border:1px solid #e3e8ef;"><strong>Doc 8896</strong></td>
<td style="padding:10px;border:1px solid #e3e8ef;">Manual pelaksanaan Annex 3 yang memberikan panduan teknis operasional.</td>
</tr>

<tr>
<td style="padding:10px;border:1px solid #e3e8ef;"><strong>Evidence</strong></td>
<td style="padding:10px;border:1px solid #e3e8ef;">Dokumen atau rekaman operasional yang menunjukkan pemenuhan PQ.</td>
</tr>

<tr>
<td style="padding:10px;border:1px solid:#e3e8ef;"><strong>LOCA</strong></td>
<td style="padding:10px;border:1px solid:#e3e8ef;">Surat koordinasi antara BMKG dan AirNav mengenai layanan meteorologi penerbangan.</td>
</tr>

<tr>
<td style="padding:10px;border:1px solid:#e3e8ef;"><strong>METAR/SPECI</strong></td>
<td style="padding:10px;border:1px solid:#e3e8ef;">Informasi cuaca aerodrome rutin (METAR) dan pada kondisi signifikan (SPECI).</td>
</tr>

<tr>
<td style="padding:10px;border:1px solid:#e3e8ef;"><strong>MWO</strong></td>
<td style="padding:10px;border:1px solid:#e3e8ef;">Meteorological Watch Office ‚Äî unit yang mengeluarkan SIGMET dan memantau fenomena cuaca berbahaya.</td>
</tr>

<tr>
<td style="padding:10px;border:1px solid:#e3e8ef;"><strong>OPMET</strong></td>
<td style="padding:10px;border:1px solid:#e3e8ef;">Data meteorologi operasional seperti METAR/SPECI, TAF, SIGMET untuk keselamatan penerbangan.</td>
</tr>

<tr>
<td style="padding:10px;border:1px solid:#e3e8ef;"><strong>PKS</strong></td>
<td style="padding:10px;border:1px solid:#e3e8ef;">Perjanjian Kerja Sama ‚Äî dokumen formal yang mengatur koordinasi BMKG dengan stakeholder penerbangan.</td>
</tr>

<tr>
<td style="padding:10px;border:1px solid:#e3e8ef;"><strong>PQ</strong></td>
<td style="padding:10px;border:1px solid:#e3e8ef;">Protocol Question ‚Äî butir kepatuhan yang menjadi dasar penilaian audit terhadap layanan meteorologi penerbangan.</td>
</tr>

<tr>
<td style="padding:10px;border:1px solid:#e3e8ef;"><strong>QMS</strong></td>
<td style="padding:10px;border:1px solid:#e3e8ef;">Quality Management System ‚Äî sistem manajemen mutu untuk menjamin layanan meteorologi sesuai standar dan terus ditingkatkan.</td>
</tr>

<tr>
<td style="padding:10px;border:1px solid:#e3e8ef;"><strong>S/NS/NA</strong></td>
<td style="padding:10px;border:1px solid:#e3e8ef;">Status implementasi: Sesuai / Tidak Sesuai / Tidak Berlaku di unit layanan.</td>
</tr>

<tr>
<td style="padding:10px;border:1px solid:#e3e8ef;"><strong>Self Assessment</strong></td>
<td style="padding:10px;border:1px solid:#e3e8ef;">Evaluasi mandiri pra-audit untuk menyatakan status pelaksanaan dan bukti tiap PQ.</td>
</tr>

<tr>
<td style="padding:10px;border:1px solid:#e3e8ef;"><strong>SIGMET</strong></td>
<td style="padding:10px;border:1px solid:#e3e8ef;">Peringatan cuaca signifikan yang berpotensi membahayakan keselamatan penerbangan.</td>
</tr>

<tr>
<td style="padding:10px;border:1px solid:#e3e8ef;"><strong>SOP</strong></td>
<td style="padding:10px;border:1px solid:#e3e8ef;">Standard Operating Procedure ‚Äî prosedur operasional terdokumentasi untuk menjamin keseragaman dan kepatuhan layanan.</td>
</tr>

<tr>
<td style="padding:10px;border:1px solid:#e3e8ef;"><strong>TAF</strong></td>
<td style="padding:10px;border:1px solid:#e3e8ef;">Prakiraan cuaca aerodrome untuk mendukung operasi penerbangan .</td>
</tr>

</tbody>

                </table>
            </div>
        </section>

        <!-- FAQ PAGE -->
        <section id="faqPage" style="display:none;">
            <div class="title" style="text-align:center;margin-bottom:16px;">
                ‚ùì FAQ Penggunaan Dashboard
            </div>
            <p style="text-align:center;color:var(--muted);font-size:14px;max-width:780px;margin:0 auto 20px;">
                Ringkasan pertanyaan yang sering muncul terkait cara menggunakan dashboard panduan audit ini.
            </p>

            <div class="faq-container">
                <div class="faq-item">
                    <div class="faq-q">1. Dashboard ini untuk apa?</div>
                    <div class="faq-a">
                        Dashboard ini adalah <b>alat bantu panduan</b> bagi Stasiun Meteorologi Penerbangan
                        (Stamet/MWO) dalam mempersiapkan pengawasan (audit) keselamatan navigasi penerbangan.
                        Fokusnya bukan menilai, tetapi membantu auditee memahami isi Protocol Question (PQ),
                        menyiapkan evidence, serta menyusun Self Assessment secara terarah.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-q">2. Apa perbedaan menu <i>Protocol Question</i> dan <i>Self Assessment</i>?</div>
                    <div class="faq-a">
                        <b>Protocol Question</b> menampilkan daftar PQ lengkap beserta tanggapan contoh, panduan pemeriksaan,
                        dan daftar evidence yang disarankan. Di sini, auditee dapat membaca makna tiap PQ.<br><br>
                        <b>Self Assessment</b> adalah halaman untuk <b>mengisi status implementasi</b> (SATISFACTORY /
                        NOT SATISFACTORY / NOT APPLICABLE), komentar, dan ringkasan evidence. Hasilnya dapat diunduh
                        dalam bentuk PDF sebagai dokumentasi internal.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-q">3. Evidence apa saja yang perlu disiapkan?</div>
                    <div class="faq-a">
                        Evidence yang dimaksud adalah dokumen atau rekaman operasional yang menunjukkan bahwa suatu PQ
                        telah dipenuhi. Contohnya:
                        <ul style="margin-top:6px;padding-left:18px;">
                            <li>SOP pengamatan, penyusunan TAF, penerbitan SIGMET, dan AD/WS Warning.</li>
                            <li>Rekaman METAR/SPECI, TAF, SIGMET, informasi OPMET, dan log operasional.</li>
                            <li>Surat koordinasi (LOCA) dan notulen rapat koordinasi dengan AirNav/Unit terkait.</li>
                            <li>Dokumen CAP dan tindak lanjut perbaikan dari temuan sebelumnya.</li>
                        </ul>
                        Rincian contoh evidence juga dapat dilihat di masing-masing PQ saat kartu diklik.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-q">4. Jika ada pertanyaan atau kendala, siapa yang dapat dihubungi?</div>
                    <div class="faq-a">
                        Untuk asistensi, klarifikasi PQ, atau pertanyaan teknis terkait penggunaan dashboard ini,
                        silakan buka menu <b>Team Contacts</b>. Di sana tercantum nama dan nomor kontak tim
                        Direktorat Meteorologi Penerbangan yang dapat dihubungi untuk pendampingan lebih lanjut.
                    </div>
                </div>
            </div>
        </section>

        <!-- KONTAK TIM -->
        <section id="KontakTimPage" style="display:none;">
          <div class="title">CP Asistensi Direktorat Meteorologi Penerbangan </div>
          <p style="color:var(--muted);margin-bottom:24px;">
            Berikut daftar kontak tim yang dapat dihubungi terkait pelaksanaan audit dan asistensi.
          </p>

          <div class="contact-grid">
            <div class="contact-card">
              <h4>Fani Setyawan</h4>
              <p class="jabatan">Kepala Pelaksana Bidang Kerjasama, Pengawasan, dan Kendali Mutu</p>
              <p class="hp">üìû <a href="https://wa.me/6282283781142" target="_blank" style="text-decoration:none; color:inherit; font-weight: inherit;">0822-8378-1142</a></p>
            </div>
            <div class="contact-card">
              <h4>Erika Meinovelia</h4>
              <p class="jabatan">PMG Madya</p>
              <p class="hp">üìû <a href="https://wa.me/6289501381214" target="_blank" style="text-decoration:none; color:inherit; font-weight: inherit;">0895-0138-1214</a></p>
            </div>
            <div class="contact-card">
              <h4>Fitria Melinda</h4>
              <p class="jabatan">PMG Muda</p>
              <p class="hp">üìû <a href="https://wa.me/6282125149154" target="_blank" style="text-decoration:none; color:inherit; font-weight: inherit;">0821-2514-9154</a></p>
            </div>
            <div class="contact-card">
              <h4>Resa Pratikasari</h4>
              <p class="jabatan">PMG Muda</p>
              <p class="hp">üìû <a href="https://wa.me/6285719734940" target="_blank" style="text-decoration:none; color:inherit; font-weight: inherit;">0857-1973-4940</a></p>
            </div>
            <div class="contact-card">
              <h4>Santi Agustina</h4>
              <p class="jabatan">PMG Muda</p>
              <p class="hp">üìû <a href="https://wa.me/6282244574220" target="_blank" style="text-decoration:none; color:inherit; font-weight: inherit;">0822-4457-4220</a></p>
            </div>
            <div class="contact-card">
              <h4>Ardhian R Cono</h4>
              <p class="jabatan">PMG Muda</p>
              <p class="hp">üìû <a href="https://wa.me/6285215039595" target="_blank" style="text-decoration:none; color:inherit; font-weight: inherit;">0852-1503-9595</a></p>
            </div>
             <div class="contact-card">
              <h4>Ilham Maulana</h4>
              <p class="jabatan">PMG Pertama</p>
              <p class="hp">üìû <a href="https://wa.me/6288802396405" target="_blank" style="text-decoration:none; color:inherit; font-weight: inherit;">0888-0239-6405</a></p>
            </div>
             <div class="contact-card">
              <h4>Yahdi Isnu</h4>
              <p class="jabatan">PMG Pertama</p>
              <p class="hp">üìû <a href="https://wa.me/6281908404853" target="_blank" style="text-decoration:none; color:inherit; font-weight: inherit;">0819-0840-4853</a></p>
            </div>
             <div class="contact-card">
              <h4>Rasti Yelmiza</h4>
              <p class="jabatan">PMG Pertama</p>
              <p class="hp">üìû <a href="https://wa.me/6281367780122" target="_blank" style="text-decoration:none; color:inherit; font-weight: inherit;">0813-6778-0122</a></p>
            </div>
          </div>
        </section>

        <!-- MODAL HOME -->
        <div class="home-card-overlay" id="homeCardOverlay">
            <div class="home-card-modal">
                <h3 id="homeCardTitle"></h3>
                <p id="homeCardDesc"></p>
                <button class="btn-close-home" onclick="closeHomeCard()">Tutup</button>
            </div>
        </div>
    </main>
</div>

<script>
    // --------- Variabel Global & Navigasi ---------
    const btnHome = document.getElementById('btnHome');
    const btnPQ = document.getElementById('btnPQ');
    const btnSelfAssessment = document.getElementById('btnSelfAssessment');
    const homePage = document.getElementById('homePage');
    const pqPage = document.getElementById('pqPage');
    const selfAssessmentPage = document.getElementById('selfAssessmentPage');
    const btnPersiapan = document.getElementById('btnPersiapan');
    const persiapanPage = document.getElementById('persiapanPage');
    const btnKontakTim = document.getElementById('btnKontakTim');
    const KontakTimPage = document.getElementById('KontakTimPage');
    const btnGambaranUmum = document.getElementById('btnGambaranUmum');
    const GambaranUmumPage = document.getElementById('GambaranUmumPage');
    const btnDownloadPDF = document.getElementById('btnDownloadPDF');
    const btnFAQ = document.getElementById('btnFAQ');
    const faqPage = document.getElementById('faqPage');

    // Info modal Home (kalau mau dipakai lagi)
    const homeCardInfo = {
        1: {
            title: "Persiapan Audit Stasiun Meteorologi Penerbangan",
            desc: "Gambaran singkat tahapan pra-audit: pengisian self assessment, penyiapan dokumen pendukung (SOP, rekaman operasional, bukti koordinasi), serta briefing internal tim sebelum pelaksanaan pengawasan."
        },
        2: {
            title: "Protocol Question (PQ)",
            desc: "Ringkasan fungsi Protocol Question sebagai daftar butir kepatuhan yang mengacu pada Annex 3, Doc 8896, dan regulasi nasional. Menu ini membantu auditee memahami makna setiap PQ dan menelusuri keterkaitan dengan prosedur serta dokumen operasional di stasiun."
        },
        3: {
            title: "Self Assessment (SA)",
            desc: "Penjelasan singkat proses penilaian mandiri oleh auditee berdasarkan setiap PQ, termasuk penetapan status implementasi (SATISFACTORY/NOT SATISFACTORY/NOT APPLICABLE), pengisian komentar, dan pencantuman evidence yang relevan."
        }
    };

    function openHomeCard(id) {
        const data = homeCardInfo[id];
        if (!data) return;
        const overlay = document.getElementById("homeCardOverlay");
        const titleEl = document.getElementById("homeCardTitle");
        const descEl = document.getElementById("homeCardDesc");
        if (titleEl) titleEl.textContent = data.title;
        if (descEl) descEl.textContent = data.desc;
        if (overlay) overlay.classList.add("show");
    }

    function closeHomeCard() {
        const overlay = document.getElementById("homeCardOverlay");
        if (overlay) overlay.classList.remove("show");
    }

    let pqInitialized = false;
    let allPqData = [];
    const pqStatusData = {};

    function showPage(page){
        // Sembunyikan semua halaman
        homePage.style.display = 'none';
        pqPage.style.display = 'none';
        selfAssessmentPage.style.display = 'none';
        persiapanPage.style.display = 'none';
        KontakTimPage.style.display = 'none';
        GambaranUmumPage.style.display = 'none';
        faqPage.style.display = 'none';

        // Reset tombol aktif
        document.querySelectorAll('.menu button').forEach(btn => btn.classList.remove('active'));

        if(page === 'home'){
            homePage.style.display = 'block';
            btnHome.classList.add('active');
        } else if(page === 'persiapan'){
            persiapanPage.style.display = 'block';
            btnPersiapan.classList.add('active');
        } else if(page === 'KontakTim'){
            KontakTimPage.style.display = 'block';
            btnKontakTim.classList.add('active');
        } else if(page === 'GambaranUmum'){
            GambaranUmumPage.style.display = 'block';
            btnGambaranUmum.classList.add('active');
        } else if(page === 'faq'){
            faqPage.style.display = 'block';
            btnFAQ.classList.add('active');
        } else if(page === 'sa'){
            selfAssessmentPage.style.display = 'flex';
            btnSelfAssessment.classList.add('active');
            if(!pqInitialized) {
                loadData().then(() => renderSelfAssessmentPage(allPqData));
            } else {
                renderSelfAssessmentPage(allPqData);
            }
        } else {
            // PQ
            pqPage.style.display = 'flex';
            btnPQ.classList.add('active');
            if(!pqInitialized){
                pqInitialized = true;
                setTimeout(() => {
                    if(typeof loadData === 'function') loadData();
                }, 50);
            } else {
                if (allPqData.length > 0) {
                    const pqGrid = document.getElementById('pqGrid');
                    pqGrid.innerHTML = '';
                    allPqData.forEach(p => pqGrid.appendChild(makeCard(p)));
                }
            }
        }
    }

    btnHome.addEventListener('click', ()=>showPage('home'));
    btnPQ.addEventListener('click', ()=>showPage('pq'));
    btnSelfAssessment.addEventListener('click', ()=>showPage('sa'));
    btnPersiapan.addEventListener('click', ()=>showPage('persiapan'));
    btnKontakTim.addEventListener('click', ()=>showPage('KontakTim'));
    btnGambaranUmum.addEventListener('click', () => showPage('GambaranUmum'));
    btnFAQ.addEventListener('click', () => showPage('faq'));
    showPage('home');

    // --------- Parsing & Loading Data PQ dari CSV ----------
    function parseCSV(text) {
        const rows = [];
        let headers = [];
        let currentRow = [];
        let currentField = '';
        let inQuotes = false;

        text = text.replace(/\r\n/g, '\n').replace(/\r/g, '\n');

        for (let i = 0; i < text.length; i++) {
            const char = text[i];
            if (char === '"' && text[i + 1] === '"' && inQuotes) {
                currentField += '"';
                i++;
                continue;
            }
            if (char === '"') {
                inQuotes = !inQuotes;
                continue;
            }
            if (char === ',' && !inQuotes) {
                currentRow.push(currentField);
                currentField = '';
                continue;
            }
            if (char === '\n' && !inQuotes) {
                currentRow.push(currentField);
                currentField = '';

                if (headers.length === 0) {
                    headers = currentRow.map(h => h.trim());
                } else {
                    const obj = {};
                    headers.forEach((header, idx) => {
                        obj[header] = (currentRow[idx] !== undefined) ? currentRow[idx].trim() : '';
                    });
                    rows.push(obj);
                }
                currentRow = [];
                continue;
            }
            currentField += char;
        }
        if (currentField.length > 0 || currentRow.length > 0) {
            currentRow.push(currentField);
            if (headers.length === 0) {
                headers = currentRow.map(h => h.trim());
            } else {
                const obj = {};
                headers.forEach((header, idx) => {
                    obj[header] = (currentRow[idx] !== undefined) ? currentRow[idx].trim() : '';
                });
                rows.push(obj);
            }
        }
        return rows;
    }

    async function loadData() {
        if (allPqData.length > 0) return;

        const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSuTmHWXmxXiKIdWbzzjTbVepYIAauvRzs5sWEfziJB793kK5ZyYzNRGf1rwUeF5iE8I0MecW4cpBdT/pub?output=csv";

        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`Gagal mengambil data: ${response.statusText}`);
            }
            const csvText = await response.text();
            const rawData = parseCSV(csvText);

            allPqData = rawData.map((row, index) => {
                const evidenceItems = row['BUKTI_DOKUMEN']
                    ? row['BUKTI_DOKUMEN'].split(/\n/).map(e => e.trim()).filter(e => e.length > 0)
                    : [];
                const pqNum = String(row['NO'] || (index + 1)).replace(/\D/g, '');

                return {
                    id: row['NO'] || (index + 1),
                    pqNum: pqNum,
                    title: row['ITEM_PROTOCOL'] || '',
                    color: (index % 2 === 0) ? 'blue' : 'orange',
                    Response: row['TANGGAPAN_AUDITEE'] || '',
                    guide: row['PANDUAN_UNTUK_PEMERIKSAAN'] || '',
                    evidence: evidenceItems,
                };
            });
            pqInitialized = true;

            if (pqPage.style.display === 'flex') {
                const pqGrid = document.getElementById('pqGrid');
                const total = document.getElementById('total-pq');
                total.textContent = allPqData.length;
                pqGrid.innerHTML = '';
                allPqData.forEach(p => pqGrid.appendChild(makeCard(p)));

                const qsearch = document.getElementById('qsearch');
                if(qsearch && !qsearch._bound) {
                    qsearch.addEventListener('input', (e)=>{
                        const q = e.target.value.trim().toLowerCase();
                        document.querySelectorAll('.pq-card').forEach(card=>{
                            const txt = card.textContent.toLowerCase();
                            card.style.display = txt.includes(q)? 'flex':'none';
                        });
                    });
                    qsearch._bound = true;
                }
            }
        } catch (error) {
            console.error("Gagal memuat atau mem-parsing data PQ:", error);
            const pqGrid = document.getElementById('pqGrid');
            if (pqGrid) pqGrid.innerHTML = "<p style='color:red;'>Gagal memuat data. Periksa koneksi atau URL CSV.</p>";
        }
    }

    // --------- Render Kartu PQ ---------
    function makeCard(item){
        const div = document.createElement('div');
        const specialPQ = ['20','21','22','39','47','48','49','51'];
        const cleanId = item.pqNum;

        let customColor = specialPQ.includes(cleanId) ? 'card-gray' :
                          (item.color === 'blue' ? 'card-blue' : 'card-orange');

        div.className = 'pq-card ' + customColor;
        div.dataset.id = item.id;

        const savedData = pqStatusData[cleanId] || {};

        let metaContent = item.guide
            ? (item.guide.length > 96 ? item.guide.substring(0, 96) + '‚Ä¶' : item.guide)
            : 'Tidak ada panduan.';

        if (savedData.status) {
            let statusText = savedData.status === 'NOT APPLICABLE' ? 'N/A' : savedData.status;
            let commentPreview = savedData.comment
                ? '| Comment: ' + savedData.comment.substring(0, 50).trim() + (savedData.comment.length > 50 ? '...' : '')
                : '';
            metaContent = `<b style="color: #B31B1B;">Status: ${statusText}</b> ${commentPreview}`;
        }

        div.innerHTML = `
            <div class="heading">${item.id}</div>
            <div style="font-weight:700">${item.title}</div>
            <div class="meta">${metaContent}</div>
            <div class="controls"></div>
        `;

        div.addEventListener('click', (e) => {
            if (e.target.tagName.toLowerCase() === 'select') return;
            openModal(item);
            document.querySelectorAll('.pq-card').forEach(c => {
                if (c !== div) c.classList.add('dimmed'); else c.classList.remove('dimmed');
            });
        });
        return div;
    }

    // Link manual untuk tombol dokumen
    const manualLinks = {
        1: "https://drive.google.com/drive/folders/1wN16BRUnAWV53vHNNoQRh1d9ZQHLTEgf?usp=sharing",
        2: "https://drive.google.com/drive/folders/1E11eFCef5TE8-25c-q5Gu33wxaAnWcjG?usp=sharing",
        3: "https://drive.google.com/drive/folders/1Tflu1d395JbugcX5lTa0gxDGmL4uYqph?usp=sharing",
        4: "https://drive.google.com/drive/folders/13_BczcCboZpy7o7DCTudMHrZqSm6PkqY?usp=sharing",
        5: "https://drive.google.com/drive/folders/1cU0wmkyUcy6D4ENhkKV-3AahW_The6Sl?usp=sharing",
        6: "https://drive.google.com/drive/folders/1cd2IYGSzMx5HMosRd8oH8GxWbhRVlTyf?usp=sharing",
        7: "https://drive.google.com/drive/folders/1gtGkHdeJOjZSUkBS4w4D3ssot-socLob?usp=sharing",
        8: "https://drive.google.com/drive/folders/19Q-8ANCXzjxEm4olpVKIwhTvxWEMkCcz?usp=sharing",
        9: "https://drive.google.com/drive/folders/1traM3yApJqvJj0PDQdHQfLcgD5Gdegpy?usp=sharing",
        10:"https://drive.google.com/drive/folders/1xWr9f5HwsxarxvmPstapM4ud-2RSWhaj?usp=sharing",
        11:"https://drive.google.com/drive/folders/1U4e3UYzVAYD9rkvlEHhKMnmD7LFgnYXP?usp=sharing",
        12:"https://drive.google.com/drive/folders/1wlVEoh96OfyKBqHEL2evYS3ioxDwYd-9?usp=sharing",
        13:"https://drive.google.com/drive/folders/1e_CtpOKTDDDSkDApjkgn_rOKeWZkxRHr?usp=sharing",
        14:"https://drive.google.com/drive/folders/1u79s-XEnBPwxruKICK-bc8Pxr5SFHyeH?usp=sharing",
        15:"https://drive.google.com/drive/folders/1dPaMbS4r6FVzY2D7arlc-QyvtnWC44Yh?usp=sharing",
        16:"https://drive.google.com/your-link-for-PQ16",
        17:"https://drive.google.com/drive/folders/1AbbTYUlZGoHjejKkxd2BJE1pUSAg90xZ?usp=sharing",
        18:"https://drive.google.com/drive/folders/19gpRdikaIhMhYMbDXEu3p7oE-QSy4jKU?usp=sharing",
        19:"https://drive.google.com/drive/folders/1G7xAHLYlqd1XbUcQzi6rY0eZv3rY9w3A?usp=sharing",
        20:"https://drive.google.com/drive/folders/1VlEDOJ-oCa5X6YWUDUr43xB9Qv_ZwzDd?usp=sharing",
        22:"https://drive.google.com/drive/folders/1mJ8UbZMtAwgD_fSMD9EMZ0EqSmWqw9lp?usp=sharing",
        23:"https://drive.google.com/drive/folders/1mJ8UbZMtAwgD_fSMD9EMZ0EqSmWqw9lp?usp=sharing",
        30:"https://drive.google.com/drive/folders/17ztUk1N1Zg56TNR2k-7CJJE9oHV5O3fm?usp=sharing",
        31:"https://drive.google.com/drive/folders/1JPvXyVPv0Uq2x2Iq_9R05z1mo4rHfxLm?usp=sharing",
        35:"https://drive.google.com/drive/folders/14Pt2AqRwin5uM2RBMunn-zamfwrmHl7B?usp=sharing",
        42:"https://drive.google.com/drive/folders/1cvZ9pfuC9GZupLL64kbLL6oNTswGBSuK?usp=sharing",
        44:"https://drive.google.com/drive/folders/1hJj9uMuKyjK7s_j8_Qbz7DBD3bZFxGv?usp=sharing",
        52:"https://drive.google.com/drive/folders/15aSd7tGJot9wIPJke4sN93x9iNxMCY85?usp=sharingt"
    };

    function openModal(item) {
        const overlay = document.getElementById('overlay');
        overlay.classList.add('show');

        const pqNum = item.pqNum;

        document.getElementById('modalTitle').textContent = item.title || '‚Äî';
        document.getElementById('modalSub').textContent = (item.id ? `${item.id} ‚Ä¢ Panduan detail` : 'Panduan detail');
        document.getElementById('modalGuide').innerHTML = (item.guide || "Tidak tersedia.").replace(/\n/g, '<br>');
        document.getElementById('modalResponse').innerHTML = (item.Response || "Tidak tersedia.").replace(/\n/g, '<br>');

        const ev = document.getElementById('modalEvidence');
        ev.innerHTML = '';
        if (Array.isArray(item.evidence) && item.evidence.length > 0) {
            const ol = document.createElement('ol');
            item.evidence.forEach(x => {
                if (x && x.trim() !== '') {
                    const li = document.createElement('li');
                    li.innerHTML = x.trim().replace(/\n/g, '<br>');
                    ol.appendChild(li);
                }
            });
            ev.appendChild(ol);
        } else {
            ev.innerHTML = "<div style='color:var(--muted)'>Tidak ada bukti dokumen spesifik.</div>";
        }

        const btnDoc = document.getElementById('modalDocBtn');
        const link = manualLinks[pqNum];
        if (link) {
            btnDoc.href = link;
            btnDoc.style.display = 'inline-flex';
        } else {
            btnDoc.href = '#';
            btnDoc.style.display = 'none';
        }
    }

    function closeModal(){
        const overlay = document.getElementById('overlay');
        if(overlay) overlay.classList.remove('show');
        document.querySelectorAll('.pq-card').forEach(c=> c.classList.remove('dimmed'));
        if (pqInitialized) loadData();
    }

    document.getElementById('btnReferensi').addEventListener('click', function() {
        window.open('https://drive.google.com/file/d/1rrlnkg63p-olxonxP8ZbpzOTyr9R68Hw/view?usp=sharing');
    });

    document.addEventListener('click', function(e){
        if(e.target && e.target.id === 'btnSearch'){
            const q = document.getElementById('qsearch');
            if(q) q.focus();
        }
    });

    // --------- SELF ASSESSMENT ---------
    function makeAssessmentForm(item) {
        const pqNum = item.pqNum;
        const currentData = pqStatusData[pqNum] || { comment: '', status: '', evidence_text: '' };

        const div = document.createElement('div');
        div.className = 'sa-card';

        div.innerHTML = `
            <div class="sa-header">${item.id}. ${item.title}</div>
            <div class="assessment-form-container">
                <form class="sa-form" data-pqid="${pqNum}">
                    <input type="hidden" name="pq_id" value="${pqNum}">

                    <label for="sa_comment_${pqNum}">Comment:</label>
                    <textarea id="sa_comment_${pqNum}" name="comment" rows="3" placeholder="Masukkan komentar atau deskripsi status terbaru.">${currentData.comment}</textarea>

                    <label for="sa_status_${pqNum}">Status of Implementation:</label>
                    <select id="sa_status_${pqNum}" name="status">
                        <option value="">-- Pilih Status --</option>
                        <option value="SATISFACTORY" ${currentData.status === 'SATISFACTORY' ? 'selected' : ''}>SATISFACTORY (Sesuai)</option>
                        <option value="NOT SATISFACTORY" ${currentData.status === 'NOT SATISFACTORY' ? 'selected' : ''}>NOT SATISFACTORY (Tidak Sesuai)</option>
                        <option value="NOT APPLICABLE" ${currentData.status === 'NOT APPLICABLE' ? 'selected' : ''}>NOT APPLICABLE (Tidak Berlaku)</option>
                    </select>

                    <label for="sa_evidence_${pqNum}">Evidence</label>
                    <textarea id="sa_evidence_${pqNum}" name="evidence_text" rows="2" placeholder="Contoh: Letter of Coordination (LOCA) antara Stasiun Meteorologi dan Perum LPPNPI/AirNav Indonesia.">${currentData.evidence_text}</textarea>

                    <div id="sa_msg_${pqNum}" class="form-message-sa" style="color: #0a5e3a;"></div>
                </form>
            </div>
        `;
        return div;
    }

    function renderSelfAssessmentPage(data) {
        const saContent = document.getElementById('saContent');
        if (!saContent) return;

        saContent.innerHTML = '';
        data.forEach(item => {
            saContent.appendChild(makeAssessmentForm(item));
        });

        bindSelfAssessmentFormListeners();
    }

    function bindSelfAssessmentFormListeners() {
        document.querySelectorAll('.sa-form').forEach(form => {
            const inputs = form.querySelectorAll('textarea, select');

            const autoSave = () => {
                const pqId = form.getAttribute('data-pqid');
                const comment = form.querySelector('textarea[name="comment"]').value;
                const status = form.querySelector('select[name="status"]').value;
                const evidence_text = form.querySelector('textarea[name="evidence_text"]').value;

                if (pqId) {
                    pqStatusData[pqId] = { comment, status, evidence_text };
                }
            };

            if (form._boundListeners) {
                form._boundListeners.forEach(({ element, event, handler }) => {
                    element.removeEventListener(event, handler);
                });
            }
            form._boundListeners = [];

            inputs.forEach(input => {
                const handler = autoSave;
                input.addEventListener('input', handler);
                form._boundListeners.push({ element: input, event: 'input', handler });
            });
        });
    }

    btnDownloadPDF.addEventListener('click', generatePDF);

    function generatePDF() {
        const downloadStatus = document.getElementById('downloadStatus');
        downloadStatus.textContent = "Mengumpulkan data dan membuat PDF... mohon tunggu.";

        const fullData = allPqData.map(item => ({
            ...item,
            savedData: pqStatusData[item.pqNum] || {}
        }));

        let pdfHTML = `
            <div id="pdf-content" style="padding: 20px; font-family: Arial, sans-serif; font-size: 12px;" class="pdf-content">
                <h1 style="text-align: center; color: #003153; font-size: 20px;">Laporan Self Assessment BMKG</h1>
                <h2 style="text-align: center; font-size: 14px; margin-bottom: 30px;">Direktorat Meteorologi Penerbangan - Status Per: ${new Date().toLocaleDateString('id-ID')}</h2>
                <div style="border: 1px solid #ddd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 style="margin-top: 0; font-size: 16px;">Ringkasan Status:</h3>
        `;

        const statusCounts = {};
        const totalPq = fullData.length;
        fullData.forEach(item => {
            const status = item.savedData.status || 'BELUM DIISI';
            statusCounts[status] = (statusCounts[status] || 0) + 1;
        });

        for (const status in statusCounts) {
            pdfHTML += `<p style="font-weight: bold;">${status}: ${statusCounts[status]} PQ</p>`;
        }
        pdfHTML += `<p>Total PQ: ${totalPq}</p></div>`;

        pdfHTML += `<h2 style="color: #003153; margin-top: 40px; border-bottom: 1px solid #ccc; padding-bottom: 10px; font-size: 16px;">Detail Protocol Question</h2>`;

        fullData.forEach(item => {
            const status = item.savedData.status || '‚Äî';
            const comment = item.savedData.comment || '‚Äî';
            const evidence = item.savedData.evidence_text || '‚Äî';

            pdfHTML += `
                <div style="margin-bottom: 20px; padding: 10px; border: 1px solid #eee; border-radius: 5px;">
                    <h3 style="color: #003153; margin-top: 5px;">${item.id}. ${item.title}</h3>
                    <p><span class="status-label">Status Implementasi:</span> <span style="font-size: 14px;">${status}</span></p>
                    <p><strong>Komentar/Deskripsi:</strong> ${comment.replace(/\n/g, '<br>')}</p>
                    <p><strong>Bukti Link/Teks:</strong> ${evidence.replace(/\n/g, '<br>')}</p>
                </div>
            `;
        });

        pdfHTML += '</div>';

        const element = document.createElement('div');
        element.innerHTML = pdfHTML;

        const filename = `Self_Assessment_BMKG_${new Date().toISOString().slice(0, 10)}.pdf`;

        const options = {
            margin: 10,
            filename: filename,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2, logging: false, useCORS: true },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };

        html2pdf().from(element).set(options).save().finally(() => {
            downloadStatus.textContent = "Download selesai!";
            setTimeout(() => downloadStatus.textContent = "", 3000);
        });
    }

    // HERO SLIDER (masih 1 slide, tapi disiapkan kalau ditambah)
    let heroCurrent = 0;
    const heroSlides = () => document.querySelectorAll('#homePage .hero-slide');
    const heroDots = () => document.querySelectorAll('#homePage .hero-dot');

    function showHeroSlide(i) {
        const slides = heroSlides();
        const dots = heroDots();
        heroCurrent = (i + slides.length) % slides.length;
        slides.forEach((s, idx) => s.classList.toggle('active', idx === heroCurrent));
        dots.forEach((d, idx) => d.classList.toggle('active', idx === heroCurrent));
    }

    function openHomeHeroModal() {
        const overlay = document.getElementById("homeCardOverlay");
        const titleEl = document.getElementById("homeCardTitle");
        const descEl = document.getElementById("homeCardDesc");

        if (titleEl) titleEl.textContent = "Tentang Sistem Ini";
        if (descEl) descEl.textContent =
            "Dashboard ini merupakan panduan pendukung bagi Stasiun Meteorologi Penerbangan dalam memahami dan menyiapkan kelengkapan kepatuhan terhadap layanan meteorologi penerbangan. Tujuan utama dashboard ini adalah membantu auditee melakukan Self Assessment secara seragam, terarah, dan terdokumentasi dengan baik, serta mempermudah penelusuran keterkaitan antara setiap Protocol Question dengan bukti operasional dan referensi regulasinya.";

        overlay.classList.add("show");
    }
</script>
</body>
</html>